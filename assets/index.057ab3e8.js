import{c as p}from"./dom.be162d4e.js";class u{constructor(t,e,h=Math.random()*20+5){this.x=t,this.y=e,this.size=h,this.vx=0,this.vy=0,this.acc=1.001;const o=Math.random()*Math.PI*2,i=Math.random()*3+.5;setTimeout(()=>{this.vx=Math.cos(o)*i,this.vy=Math.sin(o)*i},Math.random()*3e3);const c=Math.round(Math.random()*360);this.color=`hsla(${c}, 100%, 50%, 90%)`}render(t){this.x+=this.vx,this.y+=this.vy,t.fillStyle=this.color,t.beginPath(),t.arc(this.x,this.y,this.size,0,Math.PI*2),t.fill(),t.stroke()}}class g{constructor(t,e,h,o,i=20+Math.round(Math.random()*190)){this.x=t,this.y=e,this.width=h,this.height=o,this.hp=i,this.collided={},this.collidedBlur=0,this.vx=0,this.vy=0}render(t){this.vx*=.9,this.vy*=.9,this.x+=this.vx,this.y+=this.vy;const e=Object.keys(this.collided).filter(i=>this.collided[i]).length;this.collidedBlur+=e,this.collidedBlur*=.85;const h=this.width+this.collidedBlur*4,o=this.height+this.collidedBlur*4;t.fillStyle=this.collided?`hsla(${this.hp/3}, 50%, 50%, 90%)`:"#0000ff66",t.fillRect(this.x-h/2,this.y-o/2,h,o),t.fillStyle="white",t.strokeStyle="#22222266",t.strokeRect(this.x-h/2,this.y-o/2,h,o),t.textAlign="center",t.textBaseline="middle",t.fillText(this.hp+"",this.x,this.y)}getCollitionNormal(t,e){var h=this.width/2,o=this.height/2,i=t.size;const c=t.x+i>this.x-h,a=t.x-i<this.x+h,f=t.y+i>this.y-o,x=t.y-i<this.y+o,d=(t.x-this.x)/this.width,s=(t.y-this.y)/this.height,r=c&&a&&f&&x;if(this.collided[e]=r,r){const n=Math.sign(d)*1.01,l=Math.sign(s)*1.01;Math.abs(d)>=.5?(t.vx=Math.abs(t.vx)*n,t.vx+=this.vx/10):Math.abs(s)>=.5&&(t.vy=Math.abs(t.vy)*l,t.vy+=this.vy/10),this.hp-=1}return{collided:r,offsetY:s,offsetX:d}}}class m{constructor(){this.score=0,this.board=new g(15,120,30,140,100)}update(){}}const B=()=>{const y=p(),t=y.getContext("2d");if(!t)throw new Error("no 2d context");const e=y.width=800,h=y.height=600,o=new m,i=new m,c=[],a=[];for(var f=0;f<10;f++){const d=Math.random()*e/2+e/4,s=Math.random()*h,r=Math.random()*150,n=new g(d,s,5+r,5+(150-r));c.push(n)}x();function x(){if(requestAnimationFrame(x),t.clearRect(0,0,e,h),t.fillStyle="rgba(64, 64, 64, 0.15)",t.fillRect(0,0,e,h),c.forEach((s,r)=>{if(s.render(t),s.hp<=0){const n=Math.random()*e/2+e/4,l=Math.random()*h,v=Math.random()*150,M=new g(n,l,5+v,5+(150-v),Math.round(Math.min(360,Math.random()*a.length*10)));c.splice(r,1,M)}}),a.length>0){const s=a.sort((v,M)=>v.x-M.x),r=s.length-1,n=1,l=o.board.height/3;s[0].y>o.board.y+l&&(o.board.vy+=n),s[0].y<o.board.y-l&&(o.board.vy-=n),s[r].y>i.board.y+l&&(i.board.vy+=n),s[r].y<i.board.y-l&&(i.board.vy-=n),o.board.x=15,i.board.x=e-15}a.forEach((s,r)=>{c.forEach(n=>n.getCollitionNormal(s,r)),o.board.getCollitionNormal(s,"a"),i.board.getCollitionNormal(s,"b"),s.y<0+s.size/2&&(s.vy=Math.abs(s.vy*s.acc)),s.y>h-s.size/2&&(s.vy=-Math.abs(s.vy*s.acc)),s.render(t),s.x<o.board.x&&(i.score+=1,i.board.hp+=50,a.splice(r,1)),s.x>i.board.x&&(o.score+=1,o.board.hp+=50,a.splice(r,1))}),a.length<=Math.round((o.score+i.score)/5+3)&&a.push(new u(e/2,h/2)),o.board.render(t),i.board.render(t),t.fillStyle="yellow",t.strokeStyle="black",t.font="30px Arial",t.textAlign="center",t.textBaseline="top";const d=`${o.score} - ${i.score}`;t.fillText(d,e/2,20),t.strokeText(d,e/2,20),t.font="10px Arial"}};export{B as default};
