var dt=(i,t,s)=>{if(!t.has(i))throw TypeError("Cannot "+s)};var v=(i,t,s)=>{if(t.has(i))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(i):t.set(i,s)};var m=(i,t,s)=>(dt(i,t,"access private method"),s);import{l as T,r as x,g as J,p as V}from"./three.module.62571882.js";import{c as z}from"./dom.be162d4e.js";import{GameLoop as gt}from"./GameLoop.699b6383.js";function ct(i,t,s=[]){if(!i||!t)return!1;const e=(r,a)=>s.includes(r)?void 0:a;return JSON.stringify(i,e)===JSON.stringify(t,e)}function ft(i=""){const t=n=>`${i}_${n}`;return{saveBestModels:r,loadAllModelLayers:a,discardModels:l};function s(n,o,d=t(n)){var c;const u=e(n),A=["id","version","mutationIndex","mutationFactor","score"],M=`${o.length}x ${n}-${(c=o[0])==null?void 0:c.version}`,S=u[0]?o[0].score-u[0].score:o[0].score,p=`${o[0].score.toFixed(4)} ${S.toFixed(10)}`;if(S<0){console.info(`\u{1F4A3} ${M} scores ${p}`);const h=u.map(f=>({...f,diff:S,date:new Date})),g=JSON.stringify(h);localStorage.setItem(d,g)}else if(ct(o,u,A))console.info(`\u{1F62C} ${M} is identical to previous version`);else{const h=o.map(f=>({...f,version:f.version+1,diff:S,date:new Date})),g=JSON.stringify(h);console.info(`\u{1F44D} ${M} scores ${p}`),localStorage.setItem(d,g)}}function e(n,o=t(n)){let d=[];try{const u=localStorage.getItem(o);if(!u)throw new Error("not found");d=JSON.parse(u),console.debug(`Retreived ${d.length} gen-${d[0].version} for layer ${n}`)}catch{console.debug(`Nothing for layer ${n}`)}return d}function r(n,o=1){const d=new Array;n.forEach(u=>{const A=u.levels.length,M=d[A]||[];M.length>=o||(d[A]=[...M,u].sort((S,p)=>p.score-S.score))}),console.info(`\u{1F4BE} Saving best ${o} models...`),d.forEach((u,A)=>s(A,u))}function a(n=1){const o=new Array;try{for(let d=1;d<=n;d++){const u=e(d);u&&(o[d]=u)}}catch(d){console.error(d)}return o}function l(){localStorage.clear()}}class ut{constructor(){this.CAR_NB=1e3,this.AUTO_DISTRIBUTE_LAYERS=!0,this.MUTATION_LVL=.5,this.CARS_PER_LAYERS=[0,100,100,100,100,100,100,100,100,100],this.MAX_NETWORK_LAYERS=this.CARS_PER_LAYERS.length,this.SCORES_NB=this.MAX_NETWORK_LAYERS*2,this.SENSORS=9,this.SENSOR_ANGLE=Math.PI/2*2.2,this.DEATH_SPEED=.0018,this.CAR_ACCELERATION=.03,this.CAR_FRICTION=.005,this.CAR_MAX_SPEED=5,this.CLEAR_STORAGE=/clear/.test(window.location.href),this.trafficConfig=[[0,-300,.2,"A"],[1,-500,.4,"B"],[2,-300,.6,"C"],[0,-400,2,"LA"],[0,-600,2.2,"LB"],[2,-300,2,"RA"],[1,-600,2,"MA"],[2,-700,2.1,"RC"],[0,-900,2.2],[1,-900,2.3],[2,-900,2.1],[2,-950,2.4,"SP"],[1,-1400,2.5,"M0"],[0,-1550,2.3,"EL"],[2,-1550,2.4,"ER"],[0,-1950,2.2,"E2L"],[2,-1950,2.2,"E2R"]]}get CAR_PER_LEVELS(){return this.CAR_NB/this.MAX_NETWORK_LAYERS}autoDistributeByScores(t){if(!this.AUTO_DISTRIBUTE_LAYERS)return;const s=n=>t[n]&&t[n][0],e=n=>n&&n[0]&&n[0].score||0;let r=0;for(let n=1;n<this.CARS_PER_LAYERS.length;n++){const o=s(n);!o||(r+=o.score)}const a=[...t].sort((n,o)=>e(n)-e(o));let l=r;a.forEach(n=>{if(!n||!n[0])return;const o=n[0].levels.length,d=o?Math.round(l*.55):0;l-=d,this.CARS_PER_LAYERS[o]=Math.round(d/r*this.CAR_NB),console.log(`set layer ${o} with ${this.CARS_PER_LAYERS[o]} cars`)})}}const y=window.config=new ut;function pt(i,t,s,e,r,a=5,l=!1,n=!0){const o={tl:a,tr:a,br:a,bl:a};typeof a!="number"&&Object.assign(o,{tl:0,tr:0,br:0,bl:0},a),i.beginPath(),i.moveTo(t+o.tl,s),i.lineTo(t+e-o.tr,s),i.quadraticCurveTo(t+e,s,t+e,s+o.tr),i.lineTo(t+e,s+r-o.br),i.quadraticCurveTo(t+e,s+r,t+e-o.br,s+r),i.lineTo(t+o.bl,s+r),i.quadraticCurveTo(t,s+r,t,s+r-o.bl),i.lineTo(t,s+o.tl),i.quadraticCurveTo(t,s,t+o.tl,s),i.closePath(),l&&i.fill(),n&&i.stroke()}function yt(){const i=290+Math.random()*260;return"hsl("+i+", 100%, 60%)"}function P(i,t=1,s=.5,e=1){return`hsla(${Math.round(i*360)}, ${t*100}%, ${s*100}%, ${e})`}const E=14,I=Math.max(E,10);var L,N;const b=class{static getColor(t){return`hsla(56, 100%, ${Math.round((t+1)*100)}%, ${Math.abs(t)})`}static drawStats(t,s){const r=(t.canvas.height-I*2)/s.levels.length,a=150,l=8,n=18,o=a-l,d=P(s.levels.length/y.MAX_NETWORK_LAYERS);t.save(),t.translate(t.canvas.width*.5+I,r*.5),t.font=n+"px Arial",t.strokeStyle=d,t.fillStyle="rgba(32, 32, 32, .76)",pt(t,a*-.5,0,a,n*3+l*2,l,!0),t.fillStyle=d,t.textBaseline="hanging",t.textAlign="center",t.translate(0,l),t.fillText(`Network ${s.id}`,0,0,o),t.translate(0,n),t.fillText(`Mutation ${(s.mutationFactor*100).toFixed(4)}%`,0,0,o),t.translate(0,n),t.fillText(`Score ${Math.round(s.score)}`,0,0,o),t.restore()}static drawNetwork(t,s){const e=I,r=I,a=t.canvas.width-I*2,l=t.canvas.height-I*2,n=l/s.levels.length;for(let o=s.levels.length-1;o>=0;o--){const d=r+T(l-n,0,s.levels.length==1?.5:o/(s.levels.length-1));t.setLineDash([7,3]),b.drawLevel(t,s.levels[o],e,d,a,n,o==s.levels.length-1?["F","L","R","B"]:[])}}static drawLevel(t,s,e,r,a,l,n){var S,p,c,h;const o=e+a,d=r+l,{inputs:u,outputs:A,weights:M}=s;t.setLineDash([3,2]);for(let g=0;g<u.length;g++)for(let f=0;f<A.length;f++)t.beginPath(),t.moveTo(m(S=b,L,N).call(S,u,g,e,o),d),t.lineTo(m(p=b,L,N).call(p,A,f,e,o),r+E),t.lineWidth=2,t.strokeStyle=b.getColor(M[g][f]),b.getColor(M[g][f]),t.stroke();t.setLineDash([5,1]);for(let g=0;g<u.length;g++){const f=m(c=b,L,N).call(c,u,g,e,o),w=u[g];t.beginPath(),t.arc(f,d,E,0,Math.PI*2),t.fillStyle="black",t.fill(),t.beginPath(),t.arc(f,d,E*.5,0,Math.PI*2*Math.abs(w)),t.fillStyle=b.getColor(u[g]),t.strokeStyle=w>0?"orange":"green",t.lineWidth=3,t.stroke()}for(let g=0;g<A.length;g++){const f=m(h=b,L,N).call(h,A,g,e,o),w=A[g];t.beginPath(),t.arc(f,r,E,0,Math.PI*2),t.fillStyle="rgba(0, 0, 0, 0.5)",t.fill(),t.beginPath(),t.strokeStyle=w>0?"#def":"#86f",t.lineWidth=3,t.arc(f,r,E*.8,0,Math.PI*2*w),t.fillStyle=b.getColor(A[g]),t.stroke(),t.textAlign="center",t.textBaseline="middle",t.fillStyle="white",t.font=E+"px Arial",n[g]&&t.fillText(n[g],f,r+E*.1)}}};let F=b;L=new WeakSet,N=function(t,s,e,r){return T(e,r,t.length==1?.5:s/(t.length-1))},v(F,L);var R=(i=>(i[i.KEYS=0]="KEYS",i[i.DUMMY=1]="DUMMY",i[i.AI=2]="AI",i))(R||{}),k,tt;class St{constructor(t){v(this,k);switch(this.forward=0,this.left=0,this.right=0,this.reverse=0,t){case R.KEYS:m(this,k,tt).call(this);break;case R.DUMMY:this.forward=1;break}}}k=new WeakSet,tt=function(){document.onkeydown=t=>{switch(t.key){case"ArrowLeft":this.left=1;break;case"ArrowRight":this.right=1;break;case"ArrowUp":this.forward=1;break;case"ArrowDown":this.reverse=1;break}},document.onkeyup=t=>{switch(t.key){case"ArrowLeft":this.left=0;break;case"ArrowRight":this.right=0;break;case"ArrowUp":this.forward=0;break;case"ArrowDown":this.reverse=0;break}}};class Q{constructor(t,s,e=Math.ceil(t/4)){if(this.version=0,this.score=0,this.mutationFactor=.5,this.mutationIndex=.5,this.diff=0,this.date=Date.now(),t<s)throw new Error("requires more inputs than outputs");this.levels=[];for(let r=0;r<e;r++){const a=Math.floor(T(t,s,r/e)),l=Math.floor(T(t,s,(r+1)/e));this.levels.push(new $(a,l))}}static feedForward(t,s){let e=$.feedForward(t,s.levels[0]);for(let r=1;r<s.levels.length;r++)e=$.feedForward(e,s.levels[r]);return e}get id(){return[this.levels.length,this.version,this.mutationIndex].join("-")}mutate(t){if(this.version=t.version,this.levels.length!==t.levels.length){console.warn(`Neural mismatch ${this.levels.length}>${t.levels.length}`);return}for(let s=0;s<this.levels.length;s++)for(let e=0;e<this.levels[s].weights.length;e++)for(let r=0;r<this.levels[s].weights[e].length;r++)this.levels[s].weights[e][r]=T(t.levels[s].weights[e][r],x(),this.mutationFactor)}}var D,et;const q=class{constructor(t=1,s=1){var e;this.inputs=new Array(t),this.outputs=new Array(s),this.weights=[];for(let r=0;r<t;r++)this.weights[r]=new Array(s);m(e=q,D,et).call(e,this)}static feedForward(t,s){for(let e=0;e<s.inputs.length;e++)s.inputs[e]=t[e];for(let e=0;e<s.outputs.length;e++){let r=0;for(let a=0;a<s.inputs.length;a++)r+=s.inputs[a]*s.weights[a][e];s.outputs[e]=r}return s.outputs}};let $=q;D=new WeakSet,et=function(t){for(let s=0;s<t.inputs.length;s++)for(let e=0;e<t.outputs.length;e++)t.weights[s][e]=x()},v($,D);var Y,st,W,it;class At{constructor(t){v(this,Y);v(this,W);this.car=t,this.rayCount=y.SENSORS,this.rayLength=200,this.raySpread=y.SENSOR_ANGLE,this.rays=[],this.readings=[]}update(t,s){m(this,W,it).call(this),this.readings=[];for(let e=0;e<this.rays.length;e++)this.readings.push(m(this,Y,st).call(this,this.rays[e],t,s))}draw(t){for(let s=0;s<this.rays.length;s++){let e=this.rays[s][1];this.readings[s]&&(e=this.readings[s]),t.beginPath(),t.lineWidth=2,t.strokeStyle="yellow",t.moveTo(this.rays[s][0].x,this.rays[s][0].y),t.lineTo(e.x,e.y),t.stroke(),t.beginPath(),t.lineWidth=2,t.strokeStyle="black",t.moveTo(this.rays[s][1].x,this.rays[s][1].y),t.lineTo(e.x,e.y),t.stroke()}}}Y=new WeakSet,st=function(t,s,e){let r=[];for(let a=0;a<s.length;a++){const l=J(t[0],t[1],s[a][0],s[a][1]);l&&r.push(l)}for(let a=0;a<e.length;a++){const l=e[a].polygon;for(let n=0;n<l.length;n++){const o=J(t[0],t[1],l[n],l[(n+1)%l.length]);o&&r.push(o)}}if(r.length==0)return null;{const a=r.map(n=>n.offset),l=Math.min(...a);return r.find(n=>n.offset==l)}},W=new WeakSet,it=function(){this.rays=[];for(let t=0;t<this.rayCount;t++){const s=T(this.raySpread/2,-this.raySpread/2,this.rayCount==1?.5:t/(this.rayCount-1))+this.car.angle,e={x:this.car.x,y:this.car.y},r={x:this.car.x-Math.sin(s)*this.rayLength,y:this.car.y-Math.cos(s)*this.rayLength};this.rays.push([e,r])}};const wt="/phantom-game-ai-training/assets/car.3e3d3a26.png";var B,rt,U,ot,K,nt,X,at;class _{constructor(t=0,s=0,e=R.DUMMY,r=y.CAR_MAX_SPEED,a="",l=yt(),n=1){v(this,B);v(this,U);v(this,K);v(this,X);this.x=t,this.y=s,this.maxSpeed=r,this.label=a,this.color=l,this.brainLayers=n,this.polygon=[],this.width=30,this.height=50,this.va=0,this.x=t,this.y=s,this.speed=0,this.acceleration=y.CAR_ACCELERATION,this.maxSpeed=r,this.friction=y.CAR_FRICTION,this.angle=0,this.damaged=!1,this.useAI=e==R.AI,this.controls=new St(e),e!==R.DUMMY&&(this.sensor=new At(this),this.brain=new Q(this.sensor.rayCount+1,Object.keys(this.controls).length,n)),this.img=new Image,this.img.src=wt,this.mask=document.createElement("canvas"),this.mask.width=this.width,this.mask.height=this.height;const o=this.mask.getContext("2d");this.img.onload=()=>{o.fillStyle=this.color,o.rect(0,0,this.width,this.height),o.fill(),o.globalCompositeOperation="destination-atop",o.drawImage(this.img,0,0,this.width,this.height)}}update(t,s){if(!this.damaged&&(m(this,X,at).call(this),this.brain&&m(this,B,rt).call(this),this.polygon=m(this,K,nt).call(this),this.damaged=m(this,U,ot).call(this,t,s),this.sensor)){this.sensor.update(t,s);const e=this.sensor.readings.map(a=>a==null?0:1-a.offset);e.push(this.speed/this.maxSpeed);const r=Q.feedForward(e,this.brain);this.useAI&&(this.controls.forward=r[0],this.controls.left=r[1],this.controls.right=r[2],this.controls.reverse=r[3])}}draw(t,s=!1,e=0){this.sensor&&s&&this.sensor.draw(t),t.save(),t.translate(this.x,this.y),t.rotate(-this.angle),this.damaged||(t.drawImage(this.mask,-this.width*.5,-this.height*.5,this.width,this.height),t.globalCompositeOperation="multiply"),t.drawImage(this.img,-this.width*.5,-this.height*.5,this.width,this.height),t.textAlign="center",t.font="bold 11px serif",t.textBaseline="middle",t.fillStyle="rgba(0,0,0, 1)",t.fillText(`${this.label}`,0,this.height-22),t.restore()}}B=new WeakSet,rt=function(){this.brain.score+=Math.cos(this.angle)*this.speed,this.brain.score+=this.speed/2},U=new WeakSet,ot=function(t,s){for(let e=0;e<t.length;e++)if(V(this.polygon,t[e]))return!0;for(let e=0;e<s.length;e++)if(V(this.polygon,s[e].polygon))return!0;return!1},K=new WeakSet,nt=function(){const t=[],s=Math.hypot(this.width,this.height)/2,e=Math.atan2(this.width,this.height);return t.push({x:this.x-Math.sin(this.angle-e)*s,y:this.y-Math.cos(this.angle-e)*s}),t.push({x:this.x-Math.sin(this.angle+e)*s,y:this.y-Math.cos(this.angle+e)*s}),t.push({x:this.x-Math.sin(Math.PI+this.angle-e)*s,y:this.y-Math.cos(Math.PI+this.angle-e)*s}),t.push({x:this.x-Math.sin(Math.PI+this.angle+e)*s,y:this.y-Math.cos(Math.PI+this.angle+e)*s}),t},X=new WeakSet,at=function(){const{forward:t,reverse:s,left:e,right:r}=this.controls;t>0&&(this.speed+=this.acceleration*t),s>0&&(this.speed-=this.acceleration*s),this.speed>this.maxSpeed&&(this.speed=this.maxSpeed),this.speed<-this.maxSpeed/2&&(this.speed=-this.maxSpeed/2),this.speed>0&&(this.speed-=this.friction),this.speed<0&&(this.speed+=this.friction),Math.abs(this.speed)<this.friction&&(this.speed=0),e>0&&(this.va+=this.speed/300*e),r>0&&(this.va-=this.speed/300*r),this.va*=.6,this.angle+=this.va,this.x-=Math.sin(this.angle)*this.speed,this.y-=Math.cos(this.angle)*this.speed};class mt{constructor(t,s,e=3){this.x=t,this.width=s,this.laneCount=e,this.borders=[],this.x=t,this.width=s,this.laneCount=e,this.left=t-s/2,this.right=t+s/2;const r=1e6;this.top=-r,this.bottom=r;const a={x:this.left,y:this.top},l={x:this.right,y:this.top},n={x:this.left,y:this.bottom},o={x:this.right,y:this.bottom};this.borders=[[a,n],[l,o]]}getLane(t){const s=this.width/this.laneCount;return this.left+s/2+Math.min(t,this.laneCount-1)*s}draw(t){t.lineWidth=5,t.strokeStyle="white";for(let s=1;s<=this.laneCount-1;s++){const e=T(this.left,this.right,s/this.laneCount);t.setLineDash([20,20]),t.beginPath(),t.moveTo(e,this.top),t.lineTo(e,this.bottom),t.stroke()}t.setLineDash([]),this.borders.forEach(s=>{t.beginPath(),t.moveTo(s[0].x,s[0].y),t.lineTo(s[1].x,s[1].y),t.stroke()})}}var j,ht;class Z{constructor(){v(this,j);this.speed=0,this.y=150}update(){this.speed+=y.DEATH_SPEED,this.y-=this.speed}draw(t){t.save(),t.translate(0,this.y),t.fillStyle=this.gradient||m(this,j,ht).call(this,t),t.fillRect(0,0,t.canvas.width,t.canvas.height),t.restore()}}j=new WeakSet,ht=function(t){return this.gradient=t.createLinearGradient(0,1,0,100),this.gradient.addColorStop(0,"rgba(255, 255, 255, 0)"),this.gradient.addColorStop(.1,"rgba(255, 0, 0, 1)"),this.gradient.addColorStop(.2,"rgba(255, 255, 0, .5)"),this.gradient.addColorStop(.5,"rgba(255, 0, 0, .6)"),this.gradient.addColorStop(1,"rgba(0, 0, 0, .6)"),this.gradient};const Mt={cars:[],sortedCars:[],livingCars:[],traffic:[],player:new _,sortedModels:[],playing:!1},C=10,G=0;let O;function vt(i,t,s,e,r){O||(O=i.createLinearGradient(0,0,e,0),O.addColorStop(0,"#555"),O.addColorStop(1,"rgba(0, 0, 0, 0)")),i.fillStyle=O,i.fillRect(t,s,e,r)}function bt(i,t){const s=[...i.sortedModels.map(e=>e[0]).filter(Boolean),...i.sortedCars.filter((e,r)=>r<y.SCORES_NB||e===i.player)].sort((e,r)=>{const a=e instanceof _?e.brain.score:e.score;return(r instanceof _?r.brain.score:r.score)-a});vt(t,0,C*1.75,125,(s.length+2)*C),t.fillStyle=P(i.livingCars.length/i.sortedCars.length),t.font=`bold ${C}px serif`,t.fillText(`${i.livingCars.length}/${i.sortedCars.length} cars`,G,C*3),s.forEach((e,r)=>{if(e instanceof _){const a=i.sortedModels[e.brain.levels.length],l=a[0]&&a[0].score||0,n=e.brain.score-l;let o="",d="";n>0?(o=e.damaged?"\u{1F3C6}":"\u{1F49A}",d=` +${n.toFixed(2)}`):o=e.damaged?"\u{1F480}":"\u{1F49C}",t.fillStyle=e.damaged?"#def":e.color,t.fillText(`${o} ${e.label} ${Math.round(e.brain.score)}${d}`,G,C*4+r*C)}else{t.fillStyle=P(e.levels.length/y.MAX_NETWORK_LAYERS);const a=e.diff>0?`+${e.diff.toFixed(2)}`:"";t.fillText(`\u{1F47B} ${e.levels.length}-${e.version}-${e.mutationIndex} ${Math.round(e.score)} ${a}`,G,C*4+r*C)}})}const H=ft("highway");y.CLEAR_STORAGE&&H.discardModels();const Tt=async i=>{const t=z(),s=z(),e=t.getContext("2d"),r=s.getContext("2d");t.width=200;const a=Math.round(t.width/75),l=new mt(t.width/2,t.width*.9,a),n=new gt;let o,d;function u(){var p;const S=[];y.autoDistributeByScores(i.sortedModels);for(let c=1;c<=y.MAX_NETWORK_LAYERS;c++){let h=(p=i.sortedModels[c]&&i.sortedModels[c][0])!=null?p:void 0;const g=y.CARS_PER_LAYERS[c];for(let f=0;f<=g;f++){const w=new _(l.getLane(1),100,R.AI,3,`${c}-0 \u{1F476}`,P(c/y.MAX_NETWORK_LAYERS),c);if(h&&w.brain){w.brain.mutationIndex=f;const lt=Math.min(y.MUTATION_LVL,1e4/h.score*y.MUTATION_LVL);w.brain.mutationFactor=f/g*lt,w.brain.mutate(h),w.label=[c,f].join("-")}S.push(w)}}return S}try{A()}catch(S){throw S}n.play((S,p)=>{o.update();for(let h=0;h<i.traffic.length;h++)i.traffic[h].update(l.borders,[]);for(let h=0;h<i.cars.length;h++){i.cars[h].update(l.borders,i.traffic);const g=i.cars[h].y;(g>o.y||g>d.y)&&(i.cars[h].damaged=!0)}i.sortedCars=i.cars.sort((h,g)=>g.brain.score-h.brain.score),i.livingCars=i.cars.filter(h=>!h.damaged),t.height=window.innerHeight,s.height=window.innerHeight,s.width=window.innerWidth-t.width,e.save(),i.player&&!i.player.damaged?e.translate(0,-i.player.y+t.height*.7):e.translate(0,-i.sortedCars[0].y+t.height*.7),l.draw(e),o.draw(e),i.player&&(d.y=i.player.y+i.player.height,d.draw(e));for(let h=0;h<i.traffic.length;h++)i.traffic[h].draw(e);for(let h=0;h<i.cars.length;h++){const g=i.sortedCars[0]===i.cars[h]||!i.cars[h].useAI;e.globalAlpha=g?1:.3,i.cars[h].draw(e,h===0,h)}e.restore(),bt(i,e),r.lineDashOffset=-p/50,F.drawNetwork(r,i.sortedCars[0].brain),F.drawStats(r,i.sortedCars[0].brain);const c=i.livingCars.filter(h=>h.brain.mutationFactor>0);i.playing||(e.font="bold 24px Arial",e.textBaseline="middle",e.textAlign="center",e.fillStyle="red",e.strokeStyle="#800",e.lineWidth=1,e.fillText("GAME OVER",t.width/2,t.height/2),e.strokeText("GAME OVER",t.width/2,t.height/2)),c[0]||M()});function A(){Object.assign(i,Mt),i.playing=!0,i.sortedModels=H.loadAllModelLayers(y.MAX_NETWORK_LAYERS),o=new Z,d=new Z,i.traffic=y.trafficConfig.map(([c,h,g,f],w)=>new _(l.getLane(c),h,R.DUMMY,g,f||w+"")),i.cars=u();const p=[...i.sortedModels].sort((c,h)=>(h[0]?h[0].score:0)-(c[0]?c[0].score:0))[Math.round(y.MAX_NETWORK_LAYERS/2)][0];if(p){const c=p.levels.length;i.player=new _(l.getLane(1),100,R.AI,3,"\u{1F3A5} Camera",P(c/y.MAX_NETWORK_LAYERS),c),console.log(`Death car is layer ${c}`),i.player.brain.mutationFactor=0,i.player.brain.mutationIndex=0,i.player.brain.mutate(p),i.cars.push(i.player)}}function M(){if(i.playing){const S=i.sortedCars.filter(p=>p.useAI);H.saveBestModels(S.map(p=>p.brain),7),i.playing=!1,setTimeout(A,1500)}}};export{Tt as default};
